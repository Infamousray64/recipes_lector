<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Atencion VIP clientes</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='locatelfavicon.png') }}">
</head>
<body>
    <div class="container"> <!-- Nuevo contenedor -->
        <div class="header">
            <img src="{{ url_for('static', filename='locatel.png') }}" alt="Logo" class="logo">

            <form action="/" method="get">
                <input type="text" name="search" placeholder="nombre, cedula o medicamento">
                <input type="submit" value="Buscar">
            </form>

            <select id="status-filter" onchange="filterRecipes()">
                <option value="">Todos</option>
                <option value="procesado">Procesado</option>
                <option value="no procesado">No Procesado</option>
            </select>

            <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
                <input type="file" name="file" accept=".xml"> <!-- Solo acepta archivos .xml -->
                <input type="submit" value="Cargar Recipe">
            </form>
        </div>
    </div>
    <div class="fixed-title">
        <h1>AtenciÃ³n VIP clientes ðŸ’š</h1>
    </div>
    
    <div class="table-container">

    <table>
        <thead>
            <tr class="sticky-header">
            <th>ID</th>            
            <th>Fecha</th>
            <th>MÃ©dico</th>
            <th>Especialidad</th>
            <th>Pago</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Nacionalidad</th>
            <th>Cedula</th>
            <th>Telefonos</th>
            <th>Sms</th>
            <th>Correo</th>
            <th>Producto</th>
            <th>Molecula</th>
            <th>Posologia</th>
            <th>Procesado</th>
            <!-- Agrega mÃ¡s columnas segÃºn sea necesario -->
            </tr>
        </thead>
        {% for recipe in recipes %}
        <tr>
            <td>{{ recipe[0] }}</td>
            <td>{{ recipe[1] }}</td>
            <td>{{ recipe[2] }}</td>
            <td>{{ recipe[3] }}</td>
            <td>{{ recipe[4] }}</td>
            <td>{{ recipe[5] }}</td>
            <td>{{ recipe[6] }}</td>
            <td>{{ recipe[7] }}</td>
            <td>{{ recipe[8] }}</td>
            <td>{{ recipe[9] }}</td>
            <td>{{ recipe[10] }}</td>
            <td>{{ recipe[11] }}</td>
            <td>{{ recipe[12] }}</td>
            <td>{{ recipe[13] }}</td>
            <td>{{ recipe[14] }}</td>
            <td>
                <input type="checkbox" class="procesado-checkbox" data-id="{{ recipe[0] }}" {% if recipe[15] == 1 %}checked{% endif %}>
            </td>
            <!-- Agrega mÃ¡s celdas segÃºn sea necesario -->
        </tr>
        {% endfor %}
    </table>
</div>
    <script>
    function filterRecipes() {
        var status = document.getElementById("status-filter").value;
        window.location.href = "/filter?status=" + status;
    }
    </script>
    <script>
        var fileInput = document.querySelector('input[type="file"]');
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                alert('Recipe seleccionado: ' + this.files[0].name + ' ðŸ‘€');
            }
        });
    
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!fileInput.value) {
                alert('Por favor selecciona un Recipe en el boton "choose file" ðŸ“‚');
            } else {
                var formData = new FormData();
                formData.append('file', fileInput.files[0]);
    
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(data => {
                    alert('Recipe cargado exitosamente âœ…');
                    fileInput.value = ''; // Limpia el campo de archivo
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Hubo un error al cargar el Recipe âŒ');
                });
            }
        });
        document.querySelectorAll('.procesado-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            fetch('/update_procesado', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    id: this.dataset.id,
                    procesado: this.checked ? 1 : 0,
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });
    });   
    </script>
</body>
</html>